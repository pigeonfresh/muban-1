<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Component Refs | Muban</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Writing components for server-rendered HTML">
    
    <link rel="preload" href="/muban/assets/css/0.styles.fc90fd1a.css" as="style"><link rel="preload" href="/muban/assets/js/app.48237296.js" as="script"><link rel="preload" href="/muban/assets/js/2.de8cd9c4.js" as="script"><link rel="preload" href="/muban/assets/js/24.eabdf387.js" as="script"><link rel="prefetch" href="/muban/assets/js/10.7c55db09.js"><link rel="prefetch" href="/muban/assets/js/11.a9e9df60.js"><link rel="prefetch" href="/muban/assets/js/12.e7cc04fe.js"><link rel="prefetch" href="/muban/assets/js/13.cc337c60.js"><link rel="prefetch" href="/muban/assets/js/14.c7055ebb.js"><link rel="prefetch" href="/muban/assets/js/15.1fbfe614.js"><link rel="prefetch" href="/muban/assets/js/16.7f688880.js"><link rel="prefetch" href="/muban/assets/js/17.65a01f70.js"><link rel="prefetch" href="/muban/assets/js/18.e17083c9.js"><link rel="prefetch" href="/muban/assets/js/19.9532445d.js"><link rel="prefetch" href="/muban/assets/js/20.2e603409.js"><link rel="prefetch" href="/muban/assets/js/21.ddf04c2e.js"><link rel="prefetch" href="/muban/assets/js/22.60d5b2a5.js"><link rel="prefetch" href="/muban/assets/js/23.d8a186b2.js"><link rel="prefetch" href="/muban/assets/js/25.33fc5c13.js"><link rel="prefetch" href="/muban/assets/js/26.e94df976.js"><link rel="prefetch" href="/muban/assets/js/27.b0ab94dc.js"><link rel="prefetch" href="/muban/assets/js/3.4c8c1865.js"><link rel="prefetch" href="/muban/assets/js/4.af860640.js"><link rel="prefetch" href="/muban/assets/js/5.ac9e9e87.js"><link rel="prefetch" href="/muban/assets/js/6.dc00f921.js"><link rel="prefetch" href="/muban/assets/js/7.b073ec24.js"><link rel="prefetch" href="/muban/assets/js/8.44fb1b58.js"><link rel="prefetch" href="/muban/assets/js/9.2865af3c.js">
    <link rel="stylesheet" href="/muban/assets/css/0.styles.fc90fd1a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/muban/" class="home-link router-link-active"><!----> <span class="site-name">Muban</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/muban/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/muban/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/muban/api/" class="nav-link">
  Api
</a></div><div class="nav-item"><a href="/muban/research/" class="nav-link router-link-active">
  Research
</a></div> <a href="https://github.com/mubanjs/muban" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/muban/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/muban/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/muban/api/" class="nav-link">
  Api
</a></div><div class="nav-item"><a href="/muban/research/" class="nav-link router-link-active">
  Research
</a></div> <a href="https://github.com/mubanjs/muban" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/muban/research/" aria-current="page" class="sidebar-link">Research</a></li><li><a href="/muban/research/lifecycle.html" class="sidebar-link">Lifecycle</a></li><li><a href="/muban/research/component-props.html" class="sidebar-link">Component Props</a></li><li><a href="/muban/research/component-refs.html" aria-current="page" class="active sidebar-link">Component Refs</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/muban/research/component-refs.html#scoping" class="sidebar-link">Scoping</a></li><li class="sidebar-sub-header"><a href="/muban/research/component-refs.html#nodelist" class="sidebar-link">NodeList</a></li><li class="sidebar-sub-header"><a href="/muban/research/component-refs.html#marking" class="sidebar-link">Marking</a></li><li class="sidebar-sub-header"><a href="/muban/research/component-refs.html#definition" class="sidebar-link">Definition</a></li><li class="sidebar-sub-header"><a href="/muban/research/component-refs.html#using" class="sidebar-link">Using</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/muban/research/component-refs.html#reactivity" class="sidebar-link">Reactivity</a></li></ul></li><li class="sidebar-sub-header"><a href="/muban/research/component-refs.html#current-workings" class="sidebar-link">Current workings</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/muban/research/component-refs.html#_1-specify-refs-in-the-component-setup" class="sidebar-link">1. Specify refs in the component setup</a></li><li class="sidebar-sub-header"><a href="/muban/research/component-refs.html#_2-creating-the-component" class="sidebar-link">2. Creating the component</a></li><li class="sidebar-sub-header"><a href="/muban/research/component-refs.html#_3-define-the-bindings-using-refs" class="sidebar-link">3. Define the bindings using refs</a></li><li class="sidebar-sub-header"><a href="/muban/research/component-refs.html#_4-executing-the-bindings" class="sidebar-link">4. Executing the bindings</a></li></ul></li></ul></li><li><a href="/muban/research/component-dynamic-templates.html" class="sidebar-link">Dynamic Templates</a></li><li><a href="/muban/research/reactivity.html" class="sidebar-link">Exploring reactivity</a></li><li><a href="/muban/research/pure-rendering.html" class="sidebar-link">Pure rendering</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="component-refs"><a href="#component-refs" class="header-anchor">#</a> Component Refs</h1> <p>This document explores how to select elements from the DOM that are needed in your component code.</p> <p>In muban, components are mounted on existing DOM elements, instead of the component rendering it itself. This means that
in order to interact with the DOM, the component needs access to those DOM elements. The most simple way is just use
<code>querySelctor</code> on the component element; <code>element.querySelector('.child-item')</code>.</p> <p>While the above works fine for basic scenarios, we can do a lot of things to improve the Developer Experience.</p> <h2 id="scoping"><a href="#scoping" class="header-anchor">#</a> Scoping</h2> <p>In general, a component should only interact with the DOM within its own scope - not above it, and not in the DOM of its
child components. This means that <code>querySelector</code>/<code>querySelectorAll</code> should always be called on the element, or a child
DOM element thereof. But, it should not select anything into a child component. These restrictions and boundaries can
be enforced when query-selection happens through a util function. For example;</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token parameter">query</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// forces selection on the component element, never higher</span>
  <span class="token keyword">const</span> item <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// check if one of the parents of the selected item (up until the own element) is a component</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getParents</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> element<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token parameter">el</span> <span class="token operator">=&gt;</span> <span class="token function">Boolean</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>component<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Cannot select within child component boundaries'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> 
  <span class="token keyword">return</span> el<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'.child-item'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="nodelist"><a href="#nodelist" class="header-anchor">#</a> NodeList</h2> <p>When using <code>querySelectorAll</code>, a <code>NoteList</code> is returned, which is not an Array. There are ways to iterate over it, but
there are also things you can't do, but that people expect. While TypeScript guards against these situations, most
people will convert a <code>NodeList</code> into an <code>Array</code> most of the times, so it's something we can do ourselves already.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> list <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.list.item'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="marking"><a href="#marking" class="header-anchor">#</a> Marking</h2> <p>How should we mark elements in the DOM that we want to select? Should we specifically mark them for JS interaction?
That might be more work, and would require more template updates when only the JS would need to change, but the intents
are more clear. A few options:</p> <ol><li><p>Using existing CSS <code>class</code>es</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list theme-foo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-item active<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>foo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>bar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>Most elements have CSS classes applied anyway, so we can just re-use them.</p></li> <li><p>using <code>js-</code>prefixed CSS classes</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list theme-foo js-list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-item active js-list-item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>foo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-item js-list-item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>bar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>This makes it super clear that certain elements are linked to JS, so should not be (re)moved without changing the JS
as well.</p></li> <li><p>Using a <code>data-ref</code> attribute</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list theme-foo<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-item active<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>foo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>bar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ol> <p>Similar to the js-prefixes above, but moving it to a <code>data-</code>attribute, decoupling it from the CSS.</p> <p>Reusing existing CSC classes might be easier and faster, but being more explicit about the intent allows for more
features:</p> <ul><li>auto-populating the component with all the refs in the DOM</li> <li>validation opportunities</li></ul> <p>However, being explicit comes with a few disadvantages:</p> <ul><li>When selecting elements, should all element in the selection query contain the <code>js-</code> or <code>data-ref</code>? Conceptually they
probably should, since that's the reason they are separated. This might mean they need to be added on more places.</li> <li>Using <code>data-ref</code> in selectors result in more typing (<code>.list .list-item</code> vs <code>[data-ref=&quot;list&quot;] [data-ref=&quot;list-item &quot;]</code>). This step can be mitigated by only allowing data-ref values as an input array, and building the query ourselves).</li> <li><code>data-ref</code>s are only useful if they are the only way to query something, and can be made unique enough to query what
we want. The auto-populating feature above is only possible if refs are outputted in a way that their collection
groupings are uniquely identified.</li></ul> <h2 id="definition"><a href="#definition" class="header-anchor">#</a> Definition</h2> <p>Having the component specify which DOM elements are needed for your JS interaction allows for some nice features:</p> <ol><li><p>It moves query selection to a dedicated place in the component</p></li> <li><p>It allows you to specify which elements are required for your JS to work, and which can be omitted in the HTML for
different variations or use cases. Missing required elements could result in clear component errors, or used in tests
to validate the CMS rendered HTML.</p></li> <li><p>It allows the &quot;refs&quot; to become reactive, automatically executing the linked code once an optional element becomes
available in the DOM.</p></li> <li><p>It could allow to additionally select child components, being typed as such.</p></li></ol> <p>It could look something like this:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  refs<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// select a required list element</span>
    list<span class="token operator">:</span> <span class="token generic-function"><span class="token function">required</span><span class="token generic class-name"><span class="token operator">&lt;</span>HTMLUListElement<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">'.list'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// select a collection of list items, nested in the list element</span>
    listItems<span class="token operator">:</span> <span class="token generic-function"><span class="token function">collection</span><span class="token generic class-name"><span class="token operator">&lt;</span>HTMLLIElement<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">'.list'</span><span class="token punctuation">,</span> <span class="token string">'list'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token comment">// select an optional button element</span>
    button<span class="token operator">:</span> <span class="token generic-function"><span class="token function">optional</span><span class="token generic class-name"><span class="token operator">&lt;</span>HTMLButtonElement<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">'.button'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// select optional label element, is only selected when the 'button' exists</span>
    buttonLabel<span class="token operator">:</span> <span class="token generic-function"><span class="token function">optional</span><span class="token generic class-name"><span class="token operator">&lt;</span>HTMLSpanElement<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">'.button-label'</span><span class="token punctuation">,</span> <span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    
    <span class="token comment">// select optional icon component</span>
    icon<span class="token operator">:</span> component<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">optional</span><span class="token generic class-name"><span class="token operator">&lt;</span>Icon<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">'.icon'</span><span class="token punctuation">,</span> <span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">{</span> refs <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// do something with refs</span>
    <span class="token function">bind</span><span class="token punctuation">(</span>refs<span class="token punctuation">.</span>button<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">click</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> icon<span class="token punctuation">.</span><span class="token function">setProp</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'expanded'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// the refs parameter in the setup is implicitly typed as:</span>
<span class="token keyword">type</span> <span class="token class-name">Props</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  list<span class="token operator">:</span> HTMLUListElement<span class="token punctuation">;</span>
  listItems<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>HTMLLIElement<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  button<span class="token operator">?</span><span class="token operator">:</span> HTMLButtonElement<span class="token punctuation">;</span>
  buttonLabel<span class="token operator">?</span><span class="token operator">:</span> HTMLSpanElement<span class="token punctuation">;</span>
  icon<span class="token operator">?</span><span class="token operator">:</span> ComponentWrapper<span class="token operator">&lt;</span>Icon<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="only-refs"><a href="#only-refs" class="header-anchor">#</a> Only refs</h4> <p>Along with the <code>required</code> validation, we could also check if the <code>data-ref</code> value matches with the <code>refs.</code> key.</p> <p>We might not even need the xpath selector string in the definition if we make sure our <code>data-ref</code> values are unique.
However, I don't think we can force that, an element with the same ref might show up in multiple places in the DOM if
it's used as dynamic partial, without being a child component:</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>foo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list theme-foo<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-item active<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>foo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>bar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bar<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list theme-foo<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-item active<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>foo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>bar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>If we would automatically apply all <code>list</code> (as refs) instead of <code>.foo.list</code> (as selector), we would get both lists,
where we might want a specific one.
Similar with the <code>list-item</code> refs, it would group all of them in the same array.</p> <p>If we don't interact with the <code>.foo</code> and <code>.bar</code> element, and only use them to make the query selection more specific,
I don't think we should force them to also have a <code>data-ref</code>.</p> <p>We could &quot;force&quot; the HTML to always have unique refs in cases where we want to use them separately, and allow the setup
to become easier with less configuration. But it would require more strain on the template rendering, and passing data
down as context for possibly multiple levels. Then it could look like this:</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>foo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list theme-foo<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-one<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-item active<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-one-item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>foo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-one-item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>bar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">data-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>apply-button<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">data-component</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>icon<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Apply<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">data-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>apply-button-label<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Apply<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bar<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list theme-foo<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-two<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-item active<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-two-item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>foo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-two-item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>bar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  refs<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// matches data-ref=&quot;list-one&quot;</span>
    listOne<span class="token operator">:</span> <span class="token generic-function"><span class="token function">required</span><span class="token generic class-name"><span class="token operator">&lt;</span>HTMLUListElement<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// matches data-ref=&quot;list-one-item&quot; - but doens't feel good that the name is singular now: listOneItem (while it</span>
    <span class="token comment">// are multiple items</span>
    listOneItem<span class="token operator">:</span> <span class="token generic-function"><span class="token function">collection</span><span class="token generic class-name"><span class="token operator">&lt;</span>HTMLLIElement<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    applyButton<span class="token operator">:</span> <span class="token generic-function"><span class="token function">optional</span><span class="token generic class-name"><span class="token operator">&lt;</span>HTMLButtonElement<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    applyButtonLabel<span class="token operator">:</span> <span class="token generic-function"><span class="token function">optional</span><span class="token generic class-name"><span class="token operator">&lt;</span>HTMLSpanElement<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    
    <span class="token comment">// this still feels a bit weird</span>
    <span class="token comment">// we're selecting on data-componet instead, which is never unique</span>
    <span class="token comment">// so we need some kind of selector, which should probably still be a normal CSS class selector </span>
    <span class="token comment">// maybe this should live in a `components` definition instead, since it's cleary a bit different</span>
    applyButtonIcon<span class="token operator">:</span> component<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">optional</span><span class="token generic class-name"><span class="token operator">&lt;</span>Icon<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">'icon'</span><span class="token punctuation">,</span> <span class="token string">'.apply-button'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">{</span> refs <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="more-options"><a href="#more-options" class="header-anchor">#</a> More options</h4> <p>We could also support multiple selector types, giving users more choice and freedom to select whatever they want:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  refs<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// some way to not specify a ref, would instead use the attribute name ('menu' in this case)</span>
    menu<span class="token operator">:</span> <span class="token function">refElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>required<span class="token punctuation">,</span>

    <span class="token comment">// select a single item</span>
    list<span class="token operator">:</span> <span class="token function">refElement</span><span class="token punctuation">(</span><span class="token string">'list'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>required<span class="token punctuation">,</span>
    <span class="token comment">// select a collection</span>
    listItems<span class="token operator">:</span> <span class="token function">refCollection</span><span class="token punctuation">(</span><span class="token string">'listItem'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>required<span class="token punctuation">,</span>
    
    <span class="token comment">// select a nested path</span>
    otherList<span class="token operator">:</span> <span class="token function">refElement</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'container-a'</span><span class="token punctuation">,</span> <span class="token string">'list'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>optional<span class="token punctuation">,</span>
    
    <span class="token comment">// using a querySelector</span>
    specificutton<span class="token operator">:</span> <span class="token function">queryElement</span><span class="token punctuation">(</span><span class="token string">'.foo .bar .button'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>optional<span class="token punctuation">,</span>
    specificInputs<span class="token operator">:</span> <span class="token function">queryCollection</span><span class="token punctuation">(</span><span class="token string">'.foo .bar input'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    
    <span class="token comment">// an option to execute any query logic on the page to fetch the element</span>
    customItem<span class="token operator">:</span> <span class="token function">customRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> element<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.foo'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closest</span><span class="token punctuation">(</span><span class="token string">'.item'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>required<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Above, the <code>refElement</code>/<code>refCollection</code> would transform <code>'list'</code> in <code>'[data-ref=&quot;list&quot;]'</code> to use as query-selector, and
<code>['container-a', 'list']</code> would turn into <code>'[data-ref=&quot;container-a&quot;] [data-ref=&quot;list&quot;]'</code>.</p> <p>The <code>customRef()</code> could be a way to add ultimate freedom, used as an escape hatch when default selection methods are not
sufficient.</p> <h2 id="using"><a href="#using" class="header-anchor">#</a> Using</h2> <p>After configuring and fetching all the refs, we need to use them in our component. The refs can be made available the
same way as props, most likely as a function param.</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  refs<span class="token operator">:</span> <span class="token punctuation">{</span>
    button<span class="token operator">:</span> <span class="token function">refElement</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">{</span> refs <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>refs<span class="token punctuation">.</span>button<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// HTMLButtonElement</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="reactivity"><a href="#reactivity" class="header-anchor">#</a> Reactivity</h3> <p>In most cases, the rendered DOM won't change (at least, no items will be added or removed) after the page on the
server has been rendered. In most cases <code>display:none</code> would be used to (temporarily) hide something.</p> <p>However, let's explore in what situations reactivity could be useful, and how we need to design our API to deal with
this.</p> <h4 id="scenarios"><a href="#scenarios" class="header-anchor">#</a> Scenarios</h4> <ol><li><p>Dynamic lists, where new items are created/appended on interaction, and the collection array should be updated.</p></li> <li><p>A new block of content is (lazy) loaded and placed into the DOM. Selectors that were optional and previously still
undefined, can be linked up after that happens.</p> <p>Or combined with option 1, a collection of results from the backend could be loaded onto the page, replacing the
previous items in that collection.</p></li> <li><p>That new content can be removed from the DOM again, making the selectors undefined again, and cleanup should happen
on added DOM bindings.</p></li> <li><p>A complete piece of the UI is fully managed clientside from JS, and needs super dynamic DOM interactions, with loops
and conditional rendering. In this case we might want to involve client-side templates anyway.</p></li></ol> <h4 id="apis"><a href="#apis" class="header-anchor">#</a> APIs</h4> <p>Let's start with the following scenario, with a single optional button that has a text and click binding:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  refs<span class="token operator">:</span> <span class="token punctuation">{</span>
    button<span class="token operator">:</span> <span class="token function">refElement</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>optional<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">{</span> refs <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> counter <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">bind</span><span class="token punctuation">(</span>refs<span class="token punctuation">.</span>button<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">text</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Count </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>counter<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token function-variable function">click</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> counter<span class="token punctuation">.</span>value<span class="token operator">++</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>If <code>refs.button</code> is the selected DOM node, only the link between <code>refs</code> and <code>button</code> is reactive (if <code>refs</code> itself is
an observable). When passed to the <code>bind</code> function, the reactivity it has is lost, so the <code>bind</code> function cannot
re-execute its logic (again).</p> <p>I think we have these options;</p> <ol><li><p>Make the individual refs observable as well, and pass that observable to functions that require reactivity.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  refs<span class="token operator">:</span> <span class="token punctuation">{</span>
    button<span class="token operator">:</span> <span class="token function">refElement</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>optional<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">{</span> refs <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// access the value from a ref ref</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>refs<span class="token punctuation">.</span>button<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// HTMLButtonElement</span>

    <span class="token keyword">const</span> counter <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// passing a `ref`, which is observable</span>
    <span class="token function">bind</span><span class="token punctuation">(</span>refs<span class="token punctuation">.</span>button<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">text</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Count </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>counter<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token function-variable function">click</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> counter<span class="token punctuation">.</span>value<span class="token operator">++</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>Convert to a ref before passing (like we do in other cases as well).</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  refs<span class="token operator">:</span> <span class="token punctuation">{</span>
    button<span class="token operator">:</span> <span class="token function">refElement</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>optional<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">{</span> refs <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   
    <span class="token keyword">const</span> counter <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// passing a `ref`, which is observable</span>
    <span class="token function">bind</span><span class="token punctuation">(</span><span class="token function">toRef</span><span class="token punctuation">(</span>refs<span class="token punctuation">,</span> <span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">text</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Count </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>counter<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token function-variable function">click</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> counter<span class="token punctuation">.</span>value<span class="token operator">++</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>Pass the ref element within a function, which can internally be used as computed.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  refs<span class="token operator">:</span> <span class="token punctuation">{</span>
    button<span class="token operator">:</span> <span class="token function">refElement</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>optional<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">{</span> refs <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> counter <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// passing a function, so `refs.button` can be tracked when executed from a computed</span>
    <span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> refs<span class="token punctuation">.</span>button<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">text</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Count </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>counter<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token function-variable function">click</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> counter<span class="token punctuation">.</span>value<span class="token operator">++</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>Connect <code>bind</code> more closely to the component by passing a ref name as string.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  refs<span class="token operator">:</span> <span class="token punctuation">{</span>
    button<span class="token operator">:</span> <span class="token function">refElement</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>optional<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">{</span> refs <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> counter <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// passing the name of the ref, so `bind` can do the interactions</span>
    <span class="token function">bind</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">text</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Count </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>counter<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token function-variable function">click</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> counter<span class="token punctuation">.</span>value<span class="token operator">++</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ol> <p>Of course, functions like <code>bind</code> can support multiple options at the same time by checking what is passed (a string,
element, ref or function), and do the right thing. The question here is, what do we feel has the best DX, and should
be the documented default.</p> <p>The bigger question is how we should expose the refs itself. Should they be just HTML elements inside a reactive object,
or should they be observable themselves as well? In frameworks like Vue and React, when refs are linked to elements
within the template, they always are a boxed value, so they can be passed around as reference. While our current idea
by exposing all refs on a single object, because they are configured in a single place, doesn't have to follow the same
logic, it might make more sense when we think about how we pass around those refs to elements to other util functions
and our own hooks. Not having to convert them to refs ourselves might be the convenient option.</p> <h2 id="current-workings"><a href="#current-workings" class="header-anchor">#</a> Current workings</h2> <h3 id="_1-specify-refs-in-the-component-setup"><a href="#_1-specify-refs-in-the-component-setup" class="header-anchor">#</a> 1. Specify refs in the component setup</h3> <p>We can define 3 types of refs in the component setup:</p> <ol><li>single DOM elements (<code>querySelector</code>)</li> <li>a DOM collection (<code>querySelectorAll</code>)</li> <li>A component (select a single element, retrieve component instance)</li> <li>(do we need a component collection?)</li></ol> <p>Each of these are configured through a selector function, which receives the required information
to query the element, and can be passed some options (like required vs optional).</p> <p>These selector functions return a configuration object that can be used when the component is
created.</p> <h3 id="_2-creating-the-component"><a href="#_2-creating-the-component" class="header-anchor">#</a> 2. Creating the component</h3> <p>When a component is created, the selector function that exists on the configuration object is
executed for each ref (passing the component root element).</p> <p>The selector function makes sure the right element is selected, runs its validation, and can
execute other code that is needed for specific ref types (like instantiating a child component).</p> <p>Ths selector function returns the &quot;object&quot; that is passed to the setup function in the &quot;refs&quot;
parameter. It's a function with a &quot;value&quot; property attached (to access the actual DOM element, or
component).</p> <p>This function is basically a JSX Function Component - that can receive JSX props as the first
parameter.</p> <h3 id="_3-define-the-bindings-using-refs"><a href="#_3-define-the-bindings-using-refs" class="header-anchor">#</a> 3. Define the bindings using refs</h3> <p>All bindings will use the refs passed to the setup function. We mainly use JSX, but can also call
those functions directly.</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// using JSX</span>
<span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ref.fooElement</span> <span class="token attr-name">text</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>label<span class="token punctuation">}</span></span> <span class="token attr-name">click</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onClick<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token comment">// using the JS version of the JSX</span>
<span class="token keyword">return</span> <span class="token function">createElement</span><span class="token punctuation">(</span>ref<span class="token punctuation">.</span>fooElement<span class="token punctuation">,</span> <span class="token punctuation">{</span>text<span class="token operator">:</span> label<span class="token punctuation">,</span> click<span class="token operator">:</span> onClick<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// using the function directly</span>
<span class="token keyword">return</span> ref<span class="token punctuation">.</span><span class="token function">fooElement</span><span class="token punctuation">(</span><span class="token punctuation">{</span>text<span class="token operator">:</span> label<span class="token punctuation">,</span> click<span class="token operator">:</span> onClick<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// or calling the binding directly</span>
<span class="token keyword">return</span> <span class="token function">BindElement</span><span class="token punctuation">(</span><span class="token punctuation">{</span>ref<span class="token operator">:</span> ref<span class="token punctuation">.</span>fooElement<span class="token punctuation">.</span>value<span class="token punctuation">,</span> text<span class="token operator">:</span> label<span class="token punctuation">,</span> click<span class="token operator">:</span> onClick<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// or defining the node directly</span>
<span class="token keyword">return</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">'element'</span><span class="token punctuation">,</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>ref<span class="token operator">:</span> ref<span class="token punctuation">.</span>fooElement<span class="token punctuation">.</span>value<span class="token punctuation">,</span> text<span class="token operator">:</span> label<span class="token punctuation">,</span> click<span class="token operator">:</span> onClick<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_4-executing-the-bindings"><a href="#_4-executing-the-bindings" class="header-anchor">#</a> 4. Executing the bindings</h3> <p>When the setup function get executed, the following happens.</p> <ol><li>JSX is already &quot;transformed&quot; by babel/ts to the JS equivalent</li> <li>each binding is executed, and the binding function (that is returned from the ref <code>selector</code>
function) is executed, which calls <code>BindElement</code> which returns the object with all props.</li> <li>These bindings are then &quot;executed&quot; to set up the right logic for each specific binding.</li> <li>Whenever any of observables that are passed as props are changed, the bindings will re-execute.</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      
      <a href="/muban/research/component-props.html" class="prev">
        Component Props
      </a></span> <span class="next"><a href="/muban/research/component-dynamic-templates.html">
        Dynamic Templates
      </a>
      
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/muban/assets/js/app.48237296.js" defer></script><script src="/muban/assets/js/2.de8cd9c4.js" defer></script><script src="/muban/assets/js/24.eabdf387.js" defer></script>
  </body>
</html>
