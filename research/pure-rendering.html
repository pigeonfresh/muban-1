<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Pure rendering | Muban</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Writing components for server-rendered HTML">
    
    <link rel="preload" href="/muban/assets/css/0.styles.fc90fd1a.css" as="style"><link rel="preload" href="/muban/assets/js/app.48237296.js" as="script"><link rel="preload" href="/muban/assets/js/2.de8cd9c4.js" as="script"><link rel="preload" href="/muban/assets/js/26.e94df976.js" as="script"><link rel="prefetch" href="/muban/assets/js/10.7c55db09.js"><link rel="prefetch" href="/muban/assets/js/11.a9e9df60.js"><link rel="prefetch" href="/muban/assets/js/12.e7cc04fe.js"><link rel="prefetch" href="/muban/assets/js/13.cc337c60.js"><link rel="prefetch" href="/muban/assets/js/14.c7055ebb.js"><link rel="prefetch" href="/muban/assets/js/15.1fbfe614.js"><link rel="prefetch" href="/muban/assets/js/16.7f688880.js"><link rel="prefetch" href="/muban/assets/js/17.65a01f70.js"><link rel="prefetch" href="/muban/assets/js/18.e17083c9.js"><link rel="prefetch" href="/muban/assets/js/19.9532445d.js"><link rel="prefetch" href="/muban/assets/js/20.2e603409.js"><link rel="prefetch" href="/muban/assets/js/21.ddf04c2e.js"><link rel="prefetch" href="/muban/assets/js/22.60d5b2a5.js"><link rel="prefetch" href="/muban/assets/js/23.d8a186b2.js"><link rel="prefetch" href="/muban/assets/js/24.eabdf387.js"><link rel="prefetch" href="/muban/assets/js/25.33fc5c13.js"><link rel="prefetch" href="/muban/assets/js/27.b0ab94dc.js"><link rel="prefetch" href="/muban/assets/js/3.4c8c1865.js"><link rel="prefetch" href="/muban/assets/js/4.af860640.js"><link rel="prefetch" href="/muban/assets/js/5.ac9e9e87.js"><link rel="prefetch" href="/muban/assets/js/6.dc00f921.js"><link rel="prefetch" href="/muban/assets/js/7.b073ec24.js"><link rel="prefetch" href="/muban/assets/js/8.44fb1b58.js"><link rel="prefetch" href="/muban/assets/js/9.2865af3c.js">
    <link rel="stylesheet" href="/muban/assets/css/0.styles.fc90fd1a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/muban/" class="home-link router-link-active"><!----> <span class="site-name">Muban</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/muban/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/muban/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/muban/api/" class="nav-link">
  Api
</a></div><div class="nav-item"><a href="/muban/research/" class="nav-link router-link-active">
  Research
</a></div> <a href="https://github.com/mubanjs/muban" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/muban/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/muban/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/muban/api/" class="nav-link">
  Api
</a></div><div class="nav-item"><a href="/muban/research/" class="nav-link router-link-active">
  Research
</a></div> <a href="https://github.com/mubanjs/muban" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/muban/research/" aria-current="page" class="sidebar-link">Research</a></li><li><a href="/muban/research/lifecycle.html" class="sidebar-link">Lifecycle</a></li><li><a href="/muban/research/component-props.html" class="sidebar-link">Component Props</a></li><li><a href="/muban/research/component-refs.html" class="sidebar-link">Component Refs</a></li><li><a href="/muban/research/component-dynamic-templates.html" class="sidebar-link">Dynamic Templates</a></li><li><a href="/muban/research/reactivity.html" class="sidebar-link">Exploring reactivity</a></li><li><a href="/muban/research/pure-rendering.html" aria-current="page" class="active sidebar-link">Pure rendering</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/muban/research/pure-rendering.html#register-state-changes" class="sidebar-link">Register &quot;state changes&quot;</a></li><li class="sidebar-sub-header"><a href="/muban/research/pure-rendering.html#using-jsx" class="sidebar-link">Using JSX</a></li><li class="sidebar-sub-header"><a href="/muban/research/pure-rendering.html#appending-new-html" class="sidebar-link">Appending new HTML</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/muban/research/pure-rendering.html#removal-and-conditional-rendering" class="sidebar-link">Removal and conditional rendering</a></li></ul></li><li class="sidebar-sub-header"><a href="/muban/research/pure-rendering.html#tbc" class="sidebar-link">TBC</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="pure-rendering"><a href="#pure-rendering" class="header-anchor">#</a> Pure rendering</h1> <p>When dealing with state and DOM updates within components, there are to main methods of approaching this;</p> <ol><li><p>Re-render everything as a pure function, and compare the outcome to detect what DOM updates are needed.
This is how React approaches it.</p></li> <li><p>Make your state reactive, and only apply specific updates when that specific data changes.
This is how Vue/Mobx/Knockout and others approach it.</p></li></ol> <p>The advantage of the reactive approach is that the main thing we do is <em>changing</em> the dom (instead of creating it), so
what we're looking for is when changes happen - which is exactly what reactivity is made for.</p> <p>However, it can become tricky when you have to pass reactive values around - you always have to think; if I do this,
will it lose its reactivity? It can create quite some overhead, both mentally and in code.</p> <p>This is where pure render function can make things simpler; with a given start state (the HTML that exists), we run our
component function. The output it produces are the DOM changes that should be made. If we need to react on user
interactions through events, we change our internal state. That change causes a re-execution of our function, resulting
in new or updated Dom changes as output. Or, it can undo a previous change that was done.</p> <p>After each execution, we can diff the previous list of change instructions to the current one, and the difference in
that can be applied to the DOM.</p> <h2 id="register-state-changes"><a href="#register-state-changes" class="header-anchor">#</a> Register &quot;state changes&quot;</h2> <p>Let's see how that concept could work, using react hooks for the internal data structure. Let's assume we get our props
and refs from the outside.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Item</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> refs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// props.count would be our starting count, grabbed from the attributes</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>count <span class="token operator">??</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// use a toggle hook to toggle between active and not active</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isActive<span class="token punctuation">,</span> toggleActive<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useToggle</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>isActive <span class="token operator">??</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// when clicked on a button, we update our internal count</span>
  <span class="token comment">// this will cause our function to re-execute</span>
  <span class="token function">useEvent</span><span class="token punctuation">(</span>refs<span class="token punctuation">.</span>button<span class="token punctuation">,</span> <span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// listen for our toggle change</span>
  <span class="token function">useEvent</span><span class="token punctuation">(</span>refs<span class="token punctuation">.</span>toggle<span class="token punctuation">,</span> <span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// switch the toggle, which will cause this function to re-render.</span>
    <span class="token function">toggleActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// we could probably reguster useCallbacks here, and add the click binding in the below list, but that feels like</span>
  <span class="token comment">// we're duplicating things, without adding much value  </span>

  <span class="token comment">// this could register all our bindings that we ever want to change for out component</span>
  <span class="token comment">// basically, it's just a small part of a template engine, represending only the parts that we want to change </span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token function">registerState</span><span class="token punctuation">(</span>refs<span class="token punctuation">.</span>button<span class="token punctuation">,</span> <span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">count: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">registerState</span><span class="token punctuation">(</span>refs<span class="token punctuation">.</span>status<span class="token punctuation">,</span> <span class="token string">'css'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'is-active'</span><span class="token operator">:</span> isActive<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The &quot;DOM changes&quot; that were mentioned earlier don't really work well, since you never know when to return what.
You don't want to detect changes internally and register changes from there. You just want to output the state as you
know it, and let the framework do the rest. That's why each component pass should always return the same list of
&quot;potential&quot; changes. On initial execution, the output of the render should exactly match with the current DOM.</p> <p>Only when starting to react to changes, will our list start to contain actual changes.</p> <h2 id="using-jsx"><a href="#using-jsx" class="header-anchor">#</a> Using JSX</h2> <p>Instead of returning a list of state &quot;changes&quot;, what if we could return JSX, just like in react? But instead of
rendering the full Component which already exists in HTML, let's just render the part we're interested in. The only
rule is that we can only return nodes that have a unique <code>ref</code> assigned to them, so they can be matched up with the
existing HTML.</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token function">Item</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> refs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>count <span class="token operator">??</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isActive<span class="token punctuation">,</span> toggleActive<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useToggle</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>isActive <span class="token operator">??</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>refs<span class="token punctuation">.</span>status<span class="token punctuation">}</span></span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token string">'is-active'</span><span class="token operator">:</span> isActive<span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>refs<span class="token punctuation">.</span>toggle<span class="token punctuation">}</span></span> <span class="token attr-name">click</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>toggleActive<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>refs<span class="token punctuation">.</span>button<span class="token punctuation">}</span></span> <span class="token attr-name">text</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">count: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span></span> <span class="token attr-name">click</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Since it's JSX, we could use nesting to mimic our actual DOM, making it easier to locate where certain elements are.
Most likely we won't even use that information when registering the change-list and do the diffing, but we could apply
some validation and warn if it doesn't match up.</p> <h2 id="appending-new-html"><a href="#appending-new-html" class="header-anchor">#</a> Appending new HTML</h2> <p>The only thing we can't do yet, is introduce new elements, or remove any existing ones.</p> <p>Adding new elements could be done by a special node that can inject new JSX into an existing container:</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token function">Item</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> refs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>refs<span class="token punctuation">.</span>container2<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span><span class="token comment">/* append the content within here at the bottom, which is the default behaviour */</span><span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Append</span></span> <span class="token attr-name">location</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bottom<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>your value here<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Append</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>refs<span class="token punctuation">.</span>container1<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span><span class="token comment">/* or append at the top */</span><span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Append</span></span> <span class="token attr-name">location</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>top<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>your value here<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Append</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>refs<span class="token punctuation">.</span>container2<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span><span class="token comment">/* or below an existing ref, or above, or at an index, etc */</span><span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Append</span></span> <span class="token attr-name">below</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>refs<span class="token punctuation">.</span>item<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>your value here<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Append</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The tricky part of the above, is that we are communicating mutations, not state. We don't want to execute the mutation
on each render, but just once if it's there. And on a next render, we might conditionally hide the <code>&lt;Append&gt;</code> node,
which indicates that it should be removed again.</p> <p>Maybe, instead of calling it <code>Append</code>, we should treat it as an <code>exact</code> slot. A piece in the HTML we only control
from our component, just like actual react. We just need to make sure to specify that exact location. Which could be
either replacing an existing DOM item (which is there as placeholder), rendering inside it (if it was empty), or at a
specific position in an existing NodeList. That might actually work.</p> <p>That &quot;portal&quot; that we register, could actually be managed by (p)react itself if we could allow for importing existing
components in here. The only downside is that the hooks are not compatible between muban and (p)react components.</p> <h3 id="removal-and-conditional-rendering"><a href="#removal-and-conditional-rendering" class="header-anchor">#</a> Removal and conditional rendering</h3> <p>The removal part is a bit trickier. Removal could ally to complete elements (which is irreversible), or attributes on
existing HTML elements.</p> <p>We could set up a rule that whatever we want to remove, should have existind before, so it can be picked up by our
diffing algorithm. For complete elements, that would just mean the ref. For attributes, it should be the attribute with
its value the way it is rendered in the HTML. Then, whenever we conditionally <em>not</em> render that part, we know we must
remove it. And when rendering it again later, we can add it again (except for DOM nodes, unless we choose to keep them
in memory, but just detached?).</p> <p>If we won't revert DOM removal, we'll have to throw errors on any nested &quot;changes&quot; that are returned after that moment,
which should be fine.</p> <h4 id="merging-attribute-values"><a href="#merging-attribute-values" class="header-anchor">#</a> Merging attribute values</h4> <p>In some cases, most notable CSS classes, multiple values can exist in the attribute. Some values might exist in the
original HTML, while we want to only conditionally add additional ones. These types of attributes should have the
original and &quot;managed&quot; values merged in the end result. It could even be the case that those attributes are all
managed by the <a href="https://developer.mozilla.org/en-US/docs/Web/API/DOMTokenList" target="_blank" rel="noopener noreferrer">DOMTokenList<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> API, which should make
this relatively straightforward.</p> <h2 id="tbc"><a href="#tbc" class="header-anchor">#</a> TBC</h2> <p>Even though the developer interface of such pure components are quite simple, there is more to be explored around the
JSX, diffing and DOM mutation layer. And of course, the &quot;portal&quot; feature to add and manage new HTML into the dom.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/muban/research/reactivity.html" class="prev">
        Exploring reactivity
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/muban/assets/js/app.48237296.js" defer></script><script src="/muban/assets/js/2.de8cd9c4.js" defer></script><script src="/muban/assets/js/26.e94df976.js" defer></script>
  </body>
</html>
