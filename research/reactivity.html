<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Exploring reactivity | Muban</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Writing components for server-rendered HTML">
    
    <link rel="preload" href="/muban/assets/css/0.styles.fc90fd1a.css" as="style"><link rel="preload" href="/muban/assets/js/app.48237296.js" as="script"><link rel="preload" href="/muban/assets/js/2.de8cd9c4.js" as="script"><link rel="preload" href="/muban/assets/js/27.b0ab94dc.js" as="script"><link rel="prefetch" href="/muban/assets/js/10.7c55db09.js"><link rel="prefetch" href="/muban/assets/js/11.a9e9df60.js"><link rel="prefetch" href="/muban/assets/js/12.e7cc04fe.js"><link rel="prefetch" href="/muban/assets/js/13.cc337c60.js"><link rel="prefetch" href="/muban/assets/js/14.c7055ebb.js"><link rel="prefetch" href="/muban/assets/js/15.1fbfe614.js"><link rel="prefetch" href="/muban/assets/js/16.7f688880.js"><link rel="prefetch" href="/muban/assets/js/17.65a01f70.js"><link rel="prefetch" href="/muban/assets/js/18.e17083c9.js"><link rel="prefetch" href="/muban/assets/js/19.9532445d.js"><link rel="prefetch" href="/muban/assets/js/20.2e603409.js"><link rel="prefetch" href="/muban/assets/js/21.ddf04c2e.js"><link rel="prefetch" href="/muban/assets/js/22.60d5b2a5.js"><link rel="prefetch" href="/muban/assets/js/23.d8a186b2.js"><link rel="prefetch" href="/muban/assets/js/24.eabdf387.js"><link rel="prefetch" href="/muban/assets/js/25.33fc5c13.js"><link rel="prefetch" href="/muban/assets/js/26.e94df976.js"><link rel="prefetch" href="/muban/assets/js/3.4c8c1865.js"><link rel="prefetch" href="/muban/assets/js/4.af860640.js"><link rel="prefetch" href="/muban/assets/js/5.ac9e9e87.js"><link rel="prefetch" href="/muban/assets/js/6.dc00f921.js"><link rel="prefetch" href="/muban/assets/js/7.b073ec24.js"><link rel="prefetch" href="/muban/assets/js/8.44fb1b58.js"><link rel="prefetch" href="/muban/assets/js/9.2865af3c.js">
    <link rel="stylesheet" href="/muban/assets/css/0.styles.fc90fd1a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/muban/" class="home-link router-link-active"><!----> <span class="site-name">Muban</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/muban/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/muban/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/muban/api/" class="nav-link">
  Api
</a></div><div class="nav-item"><a href="/muban/research/" class="nav-link router-link-active">
  Research
</a></div> <a href="https://github.com/mubanjs/muban" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/muban/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/muban/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/muban/api/" class="nav-link">
  Api
</a></div><div class="nav-item"><a href="/muban/research/" class="nav-link router-link-active">
  Research
</a></div> <a href="https://github.com/mubanjs/muban" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/muban/research/" aria-current="page" class="sidebar-link">Research</a></li><li><a href="/muban/research/lifecycle.html" class="sidebar-link">Lifecycle</a></li><li><a href="/muban/research/component-props.html" class="sidebar-link">Component Props</a></li><li><a href="/muban/research/component-refs.html" class="sidebar-link">Component Refs</a></li><li><a href="/muban/research/component-dynamic-templates.html" class="sidebar-link">Dynamic Templates</a></li><li><a href="/muban/research/reactivity.html" aria-current="page" class="active sidebar-link">Exploring reactivity</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/muban/research/reactivity.html#value-vs-reference" class="sidebar-link">value vs reference</a></li><li class="sidebar-sub-header"><a href="/muban/research/reactivity.html#observable-core-concept" class="sidebar-link">Observable core concept</a></li><li class="sidebar-sub-header"><a href="/muban/research/reactivity.html#dependency-tracking" class="sidebar-link">Dependency tracking</a></li><li class="sidebar-sub-header"><a href="/muban/research/reactivity.html#losing-reactivity" class="sidebar-link">Losing reactivity</a></li><li class="sidebar-sub-header"><a href="/muban/research/reactivity.html#different-libraries" class="sidebar-link">Different libraries</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/muban/research/reactivity.html#vue-composition" class="sidebar-link">Vue Composition</a></li><li class="sidebar-sub-header"><a href="/muban/research/reactivity.html#mobx" class="sidebar-link">MobX</a></li><li class="sidebar-sub-header"><a href="/muban/research/reactivity.html#knockout-js" class="sidebar-link">Knockout JS</a></li><li class="sidebar-sub-header"><a href="/muban/research/reactivity.html#verdict" class="sidebar-link">Verdict</a></li></ul></li></ul></li><li><a href="/muban/research/pure-rendering.html" class="sidebar-link">Pure rendering</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="exploring-reactivity"><a href="#exploring-reactivity" class="header-anchor">#</a> Exploring reactivity</h1> <p>When dealing with state and DOM updates within components, there are two main methods of approaching this;</p> <ol><li><p>Re-render everything as a pure function, and compare the outcome to detect what DOM updates are needed.
This is how React approaches it.</p></li> <li><p>Make your state reactive, and only apply specific updates when that specific data changes.
This is how Vue/Mobx/Knockout and others approach it.</p></li></ol> <p>The advantage of the pure approach is that it's relatively easy to reason about; the same input will always give the
same output, and your state are just primitive values that are passed around.</p> <p>However, it becomes more tricky once you need to react to changes in your data, or user input, and produce side effects.
At this point, you would have to manually specify dependencies for your side-effects. And to keep things
performant, memoizing computations or non-primitive references should be applied, adding further need to use manual
dependencies to update them when needed.</p> <p>This is where reactivity can make things simpler, by tracking dependencies automatically when used. However, it comes
with it own rules that you have to follow, mostly related to passing around those observables in a way that dependency
tracking can do its job.</p> <h2 id="value-vs-reference"><a href="#value-vs-reference" class="header-anchor">#</a> value vs reference</h2> <p>In Javascript, you have primitives (like string, number, boolean) that represent single values. When you pass them
around, you always pass their value. Reassigning them does nothing to earlier variables.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> a<span class="token punctuation">;</span> <span class="token comment">// becomes 1, but is not connected to a</span>
b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token comment">// a = 1</span>
<span class="token comment">// b = 2</span>
a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token comment">// a = 3</span>
<span class="token comment">// b = 2</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  value<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token comment">// &quot;value&quot; becomes 2</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token function">foo</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// &quot;a&quot; still is 1</span>
</code></pre></div><p>When you deal with references (like objects and arrays), you pass them around by reference. And changes to the object
in one place, will update the object in other places.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
  count<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> a<span class="token punctuation">;</span> <span class="token comment">// they now point to the same object</span>
b<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token comment">// a.count = 2</span>
<span class="token comment">// b.count = 2</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  value<span class="token punctuation">.</span>count<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token comment">// &quot;value.count&quot; becomes 2</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
  count<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">foo</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// &quot;a.count&quot; also is 2</span>
</code></pre></div><p>However, once you disconnect the &quot;count&quot; from the object, it becomes a primitive again:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  value<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token comment">// &quot;value&quot; becomes 2</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
  count<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">foo</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// passing a primitive, you disconnect it from the object</span>
<span class="token comment">// &quot;a.count&quot; still is 1</span>
</code></pre></div><p>Reactivity works in the same way. It works as long as you keep passing references (to objects) around, but as soon as
you use destructuring, or pass along an object property that is primitive value, it stops working.</p> <h2 id="observable-core-concept"><a href="#observable-core-concept" class="header-anchor">#</a> Observable core concept</h2> <p>The core concept of reactivity is to be able to observe reads and writes to objects. If I <strong>change</strong> an observable,
it should &quot;reexecute&quot; everything where I <strong>used</strong> that variable before.</p> <p>There are 2 main ways of reacting to changes:</p> <ol><li>explicitly subscribing to changes on an observable</li> <li>reading observables in functions that &quot;tracks&quot; them while executing the function, and re-execute the function when
one of them changes. This can be split up in two different use cases as well.
<ol><li>Using a function to produce a new value that is returned - often called a &quot;computed&quot; or a &quot;selector&quot;.</li> <li>Using a function to produce side effects (like logging, doing API calls, etc). Which is similar manually
subscribing, but in this case the subscription happens automatically, and on multiple observables at the same time.</li></ol></li></ol> <p>Examples:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">observable</span><span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 1. explicitly subscribe</span>
state<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'count'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  newValue<span class="token punctuation">;</span> <span class="token comment">// 2</span>
  state<span class="token punctuation">.</span>count<span class="token punctuation">;</span> <span class="token comment">// 2</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 2.i create a computed value</span>
<span class="token comment">// double changes every time that &quot;state.count&quot; is updated</span>
<span class="token keyword">const</span> double <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>count <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// currently is still &quot;2&quot;</span>

<span class="token comment">// 2.ii create a side effect</span>
<span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// this log will be fired whenever the count or the double will update</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>count<span class="token punctuation">,</span> double<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  state<span class="token punctuation">.</span>count<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// this will change the count, and notify that it has changed;</span>
  
  double<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// this is now 4</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>Note</strong>: In the above code, the <code>double</code> computed returned is not a number itself, but rather an observable object
that has a <code>get</code> method to get the latest value. This is explained further below, and has to do with the primitives.</p> <p>Objects and primitives should be handled a bit differently from each other; primitives should be &quot;boxed&quot; inside an
object to be passed around as reference, and to track its reads and writes:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> counter <span class="token operator">=</span> <span class="token function">boxed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// outputs 1</span>

<span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// this log will be fired whenever the counter updates</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  counter<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// will trigger the watchEffect above, and log &quot;2&quot;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// outputs 2</span>
<span class="token punctuation">}</span>
</code></pre></div><p>With observable objects the tracking happens through <code>state.count</code>, while with boxed primitives, the tracking happens
through the <code>counter.get</code> and <code>counter.set</code>.</p> <p>Computed properties often return a value that should be observable, and can be a primitive. That is why the computed
in the first code example also uses <code>double.get()</code>. If the <code>computed(...)</code> function just returned a number, you could
not use it in any other place.</p> <p>Some libraries choose to expose a <code>.value</code> property on a boxed/computed to replace the <code>get/set</code> functions, so it can
be used in a similar way as other observables (e.g. <code>counter.value++</code> and <code>console.log(counter.value)</code>).</p> <h2 id="dependency-tracking"><a href="#dependency-tracking" class="header-anchor">#</a> Dependency tracking</h2> <p>When using <code>counter.set()</code>, it's pretty clear that a function is called, and that internal logic can be executed to
notify the usages of the <code>counter</code>. Similarly, <code>counter.value++</code> or <code>state.count++</code> internally use an ES5 getter/setter
that is exposed as a function, or by using an es6 proxy which also executes a function internally.</p> <p>For <code>counter.get()</code> / <code>counter.value</code> / <code>state.count</code> this happens in a similar way. The underlying code knows when you
are reading the value. Keep this in mind.</p> <p>Dependency tracking is not used just everywhere. If I just create an observable, and log its value, it won't
automatically happen again when I change its value:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">observable</span><span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
state<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// besides changing the value, nothing happens here</span>
</code></pre></div><p>However, when I'm in a <code>watch</code> function, something does happen:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">observable</span><span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// this log will be fired whenever the counter updates</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

state<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// now, the watchEffect gets executed again</span>
</code></pre></div><p>So, how does this work? Whenever the <code>watchEffect</code> function is executing its passed callback function, it keeps track
of every observable that's being read while executing this function. It than subscribes to each of them, and re-executes
the passed callback function again if something changes. It looks similar to this:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// pseudo code - this is not how it actually works</span>
<span class="token keyword">function</span> <span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> tracked <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token function">reportReadsTo</span><span class="token punctuation">(</span>tracked<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">stopReportingReads</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  tracked<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token operator">=&gt;</span> t<span class="token punctuation">.</span><span class="token function">subscrube</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">watchEffect</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This not only happens for <code>watchEffect</code>, but also for a <code>computed</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">observable</span><span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// the computed function gets executed, because `state.count` is tracked.</span>
<span class="token keyword">const</span> double <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>count <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// this log will be fired whenever the counter updates</span>
  <span class="token comment">// or whenever double changes </span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>count<span class="token punctuation">,</span> double<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

state<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// now, both `double` computed, and the `watchEffect` will be called</span>
</code></pre></div><h2 id="losing-reactivity"><a href="#losing-reactivity" class="header-anchor">#</a> Losing reactivity</h2> <p>There are common pitfalls when passing reactive data around where you loose reactivity. The most common ones within
a component context is passing to, and returning from, helper functions:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">duplicate</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">observable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    double<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">.</span>double <span class="token operator">=</span> value <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  
  <span class="token keyword">return</span> state<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">observable</span><span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// we loose reactivity twice.</span>
<span class="token comment">// 1. When passing the value, we just pass the primitive '1'</span>
<span class="token comment">// 2. When destructuring the return, double ust contains the primitive '2'</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> double <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">duplicate</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>double<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

state<span class="token punctuation">.</span>count<span class="token operator">++</span><span class="token punctuation">;</span>
</code></pre></div><p>We have 2 <code>watchEffect</code> functions in the above example. The first in the <code>duplicate</code> function, that should execute when
the <code>value</code> changes. It doesn't because it receives a primitive. The second should log <code>double</code> whenever it changes.
It doesn't, because it's destructured in a primitive. Let's fix it:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">duplicate</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">observable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    double<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// we now use `value.get();</span>
    state<span class="token punctuation">.</span>double <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  
  <span class="token comment">// we convert the return value to a boxed primitve, that's kept in sync with the state observable</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> double<span class="token operator">:</span> <span class="token function">toBoxed</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token string">'double'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">observable</span><span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// we convert the passed argument to a boxed primitive, that's kept in sync with the state observable</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> double <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">duplicate</span><span class="token punctuation">(</span><span class="token function">toBoxed</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token string">'count'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// we use `double.get()` to log it </span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>double<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

state<span class="token punctuation">.</span>count<span class="token operator">++</span><span class="token punctuation">;</span>
</code></pre></div><p>As you can see, every time we need to pass primitives from and to functions, we wrap them in a boxed object to pass them
as reference, which keeps the reactivity alive.</p> <p>This necessity is the biggest &quot;downside&quot; of reactivity.</p> <h2 id="different-libraries"><a href="#different-libraries" class="header-anchor">#</a> Different libraries</h2> <p>Below we will explore how different libraries deal with the reactivity concepts above. We'll look at Vue 3, where this
is used in the composition API. We'll have al ook at MobX, where this is the core part of their library. Lastly,
we take a look at Knockout JS, which has been around for a while and currently still used in Muban for DOM binding.</p> <h3 id="vue-composition"><a href="#vue-composition" class="header-anchor">#</a> Vue Composition</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// --- primitive</span>
<span class="token keyword">const</span> counter <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// create</span>

counter<span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// read</span>
counter<span class="token punctuation">.</span>value<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// write</span>


<span class="token comment">// --- objects</span>
<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// create</span>

state<span class="token punctuation">.</span>count<span class="token punctuation">;</span> <span class="token comment">// read</span>
state<span class="token punctuation">.</span>count<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// write</span>


<span class="token comment">// --- convert to ref</span>
<span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">toRef</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token string">'count'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// single value</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> count <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">toRefs</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// all object keys</span>


<span class="token comment">// --- use refs in reactive</span>
<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token operator">:</span> counter<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// refs auto-unwrap and keep their 2-way binding</span>

state<span class="token punctuation">.</span>count<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// also updates the `counter` ref</span>


<span class="token comment">// --- computed - readonly</span>
<span class="token keyword">const</span> double <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> count<span class="token punctuation">.</span>value <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returned `double` is a `ref`</span>

double<span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// read</span>


<span class="token comment">// --- computed - read and write</span>
<span class="token keyword">const</span> double <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> count<span class="token punctuation">.</span>value <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token parameter">val</span> <span class="token operator">=&gt;</span> count<span class="token punctuation">.</span>value <span class="token operator">=</span> val <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// writes back to the `count` ref</span>

double<span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// read</span>
double<span class="token punctuation">.</span>value<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// write</span>


<span class="token comment">// --- watchEffect - implicit dependecies</span>
<span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// executes immediately to start tracking used dependencies,</span>
<span class="token comment">// and executes again whenever they cnage</span>


<span class="token comment">// --- watch - explicit dependencies</span>
<span class="token function">watch</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>count<span class="token punctuation">,</span> <span class="token comment">// from reactive objects, as a function</span>
  <span class="token punctuation">(</span><span class="token parameter">count<span class="token punctuation">,</span> prevCount</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">watch</span><span class="token punctuation">(</span>
  counter<span class="token punctuation">,</span> <span class="token comment">// or directly for a single ref</span>
  <span class="token punctuation">(</span><span class="token parameter">count<span class="token punctuation">,</span> prevCount</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// can also return an array or object to watch multiple values at the same time</span>
<span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>foo<span class="token punctuation">,</span> bar<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>foo<span class="token punctuation">,</span> bar<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h3 id="mobx"><a href="#mobx" class="header-anchor">#</a> MobX</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// --- primitive</span>
<span class="token keyword">const</span> counter <span class="token operator">=</span> observable<span class="token punctuation">.</span><span class="token function">boxed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// create</span>

counter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// read</span>
counter<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// write</span>


<span class="token comment">// --- objects</span>
<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">observable</span><span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// create</span>

state<span class="token punctuation">.</span>count<span class="token punctuation">;</span> <span class="token comment">// read</span>
state<span class="token punctuation">.</span>count<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// write</span>


<span class="token comment">// --- convert to ref</span>
<span class="token comment">// not natively possible, but can be doen by using a writable computed</span>
<span class="token keyword">const</span> <span class="token function-variable function">toRef</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> field</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>obj<span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> obj<span class="token punctuation">[</span>field<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">toRef</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token string">'count'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// single value</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> count <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">toRefs</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// all object keys</span>


<span class="token comment">// --- use boxed in observable - only by value</span>
<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">observable</span><span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token operator">:</span> counter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// loses reactivity</span>

state<span class="token punctuation">.</span>count<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// doesn't update original boxed value</span>


<span class="token comment">// --- computed - readonly</span>
<span class="token keyword">const</span> double <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> count<span class="token punctuation">.</span>value <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returned `double` is a `ref`</span>

double<span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// read</span>


<span class="token comment">// --- computed - read and write</span>
<span class="token keyword">const</span> double <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> counter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token parameter">val</span> <span class="token operator">=&gt;</span> counter<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>val <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// writes back to the `count` ref</span>

double<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// read</span>
double<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// write</span>


<span class="token comment">// --- autorun - implicit dependecies</span>
<span class="token function">autorun</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// executes immediately to start tracking used dependencies,</span>
<span class="token comment">// and executes again whenever they cnage</span>


<span class="token comment">// --- reaction - explicit dependencies</span>
<span class="token function">reaction</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>count<span class="token punctuation">,</span> <span class="token comment">// from reactive objects, as a function</span>
  <span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// can also return an array or object to watch multiple values at the same time</span>
<span class="token function">reaction</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>foo<span class="token punctuation">,</span> bar<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>foo<span class="token punctuation">,</span> bar<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="knockout-js"><a href="#knockout-js" class="header-anchor">#</a> Knockout JS</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// --- primitive</span>
<span class="token keyword">const</span> counter <span class="token operator">=</span> ko<span class="token punctuation">.</span><span class="token function">observable</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// create</span>

<span class="token function">counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// read</span>
<span class="token function">counter</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// write</span>


<span class="token comment">// --- objects - are shallow/ref by default</span>
<span class="token keyword">const</span> state <span class="token operator">=</span> ko<span class="token punctuation">.</span><span class="token function">observable</span><span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token operator">:</span> ko<span class="token punctuation">.</span><span class="token function">obsevable</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// create</span>

<span class="token function">state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// read</span>
<span class="token function">state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// write</span>


<span class="token comment">// --- convert to ref</span>
<span class="token comment">// primitives and objects are all observable, so need for conversion</span>


<span class="token comment">// --- next obsevables </span>
<span class="token keyword">const</span> state <span class="token operator">=</span> ko<span class="token punctuation">.</span><span class="token function">observable</span><span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token operator">:</span> counter<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// auto reactivity</span>

<span class="token function">state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// also updates the counter observable</span>


<span class="token comment">// --- computed - readonly</span>
<span class="token keyword">const</span> double <span class="token operator">=</span> ko<span class="token punctuation">.</span><span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> count<span class="token punctuation">.</span>value <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returned `double` is a `ref`</span>

<span class="token function">double</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// read</span>


<span class="token comment">// --- computed - read and write</span>
<span class="token keyword">const</span> double <span class="token operator">=</span> ko<span class="token punctuation">.</span><span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">read</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token function-variable function">write</span><span class="token operator">:</span> <span class="token parameter">val</span> <span class="token operator">=&gt;</span> <span class="token function">counter</span><span class="token punctuation">(</span>val <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// writes back to the `count` ref</span>

<span class="token function">double</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// read</span>
<span class="token function">double</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// write</span>


<span class="token comment">// --- subscribe - to a single obsevable or computed</span>
counter<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">newValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// not possible to listen to multiple at the same time, but a computed + subscription can be abused for that</span>
<span class="token keyword">function</span> <span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> comp <span class="token operator">=</span> ko<span class="token punctuation">.</span><span class="token function">computed</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">comp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// fire immediately to start tracing dependencies</span>
  <span class="token keyword">return</span> comp<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h3 id="verdict"><a href="#verdict" class="header-anchor">#</a> Verdict</h3> <p>Knockout JS is the simplest, both in usage and in features. It doesn't have the issues with passing around primitives,
since everything is always an observable itself. The downside is that everything requires <code>()</code> to access, and that
deep observable initialisation is not done by the library itself.
Of course, knockout already has DOM bindings that work perfectly with the observables, so that's a big plus.</p> <p>MobX has a lot more options and utils not shown above, which the others don't have. However, it's missing some critical
features for managing primitives in an easy and reactive way. MobX is mostly used as objects/classes where this is
less of an issue, but within component state, when passing around al lot of primitive values, it loses a bit of its
power.</p> <p>Vue Composition API is tailored for use in components, so that is where it shines. The downside is that the current
reactive API is tied into the Vue component system, so a fork of that part of the library would be needed to use it
within muban components.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/muban/research/component-dynamic-templates.html" class="prev">
        Dynamic Templates
      </a></span> <span class="next"><a href="/muban/research/pure-rendering.html">
        Pure rendering
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/muban/assets/js/app.48237296.js" defer></script><script src="/muban/assets/js/2.de8cd9c4.js" defer></script><script src="/muban/assets/js/27.b0ab94dc.js" defer></script>
  </body>
</html>
